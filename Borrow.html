<head>
</head>

<template name="borrow">

  <div class="container panel-defaults panel">

  <ul class="nav nav-justified nav-pills">
  <li role="presentation" class="active"><a href="#">Looking for a specific book!</a></li>
  <li role="presentation"><a href="{{pathFor route='suggestions'}}">Looking for reading suggestions!</a></li>
  </ul>

	<br>
      <h3><span class="label label-primary">1</span> <img src="/arrow.png" height="25">  Search your next reading in your neighbourhood!</h3>
      <!-- Affiche la SearchBar -->
  	{{>searchBar}} <br>

	<div class="row">
  <div class="col-xs-12 col-sm-6 col-md-8"> 
 <!-- Affiche les résultats de la searchBar-->
    	{{> displaySearch}}
  </div>
  <div class="center-block">
  <div class="col-xs-6 col-sm-4"> 
  		    {{> displayChosenBook}}
    
    </div>
  </div>
  </div>
	
	<br>
      <h3><span class="label label-primary">2</span> <img src="/arrow.png" height="25">  Look for the best place to pick your book!</h3>
    <!-- Affiche les boutons radios pour savoir ou est le centre de la carte -->
    {{>locationRadioButtons}}
    <!-- Affiche la carte des bouquins disponibles-->
    {{>booksMap}}

    <br>

    <br>
      <h3><span class="label label-primary">3</span> <img src="/arrow.png" height="25">  Contact your neighbour!</h3>
    <br>

 	

	{{> displayAvailableBooks}}
</div>
</template>


<!-- ******************************************************** -->

<template name="searchBar">
<!--Barre de recherche d'un livre (vient taper dans INFOS_BOOKS, pas forcément disponible) -->
    
   <!-- Le time out permet d'attendre un peu avant d'actualiser. Meilleure expérience utilisateur 
// cherche les attributs de mon input easySearch
-->	
<div class="input-group">
<span class="input-group-addon">
<span class="glyphicon glyphicon-book" aria-hidden="true"></span>
</span>
{{> EasySearch.Input index=biIndex timeout=400 attributes=inputAttributes}}
</div>
</template>

<!-- ******************************************************** -->


<!-- Radio buttons so as to know from which location he'd like to borrow books  -->
<template name="locationRadioButtons">
  <div class="btn-group" data-toggle="buttons" id="radioLocButtons">

<label class="btn btn-primary"> <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span> Borrow from </label>
	{{#if isThisAnAddress.add1}}
  <label class="btn btn-default">
    <input type="radio" name="borrowLoc" id="home" autocomplete="off" checked> home
  </label>
  {{/if}}
  	{{#if isThisAnAddress.add2}}
  <label class="btn btn-default">
    <input type="radio" name="borrowLoc" id="work" autocomplete="off"> work
  </label>
  {{/if}}
  <label class="btn btn-default active">
    <input type="radio" name="borrowLoc" id="position" autocomplete="off"> my position
  </label>
</div>
</template>

<!-- ******************************************************** -->

<template name="displaySearch">
<!-- Renders the content when the associated input is being searched. Allows multiple indexes. -->
{{#EasySearch.IfSearching index=biIndex}}
  <div>Searching...</div>
{{/EasySearch.IfSearching}}

 <!-- Affiche tous les bouquins correspondant à la recherche -->
{{#EasySearch.Each index=biIndex}}
<a class="img-thumbnail img-responsive searchBooks">
{{> bookimage}}         
</a>
{{/EasySearch.Each}}
   
<!-- Ça les charge 10 par 10, si il y en a besoin de plus... il suffit de cliquer -->
<br>
{{> EasySearch.LoadMore index=biIndex attributes=moreButtonAttributes}}


<br><br> Ancienne version

 {{#EasySearch.IfNoResults index=biIndex}}
    <div class="no-results">No results found!</div>
  {{/EasySearch.IfNoResults}}

	<form>

        <input type="text" name="searchedBook" placeholder="Titre du livre recherché">
        <input type="submit" value="Recherchez dans Colibry">
    </form>

    <div class="row">
	<div class="col-xs-12 col-sm-6 col-md-8"> {{> displaySearchedBooks}}
	</div>
	<div class="center-block">
	<div class="col-xs-6 col-md-4"> 
    </div>
    </div>
    </div>
</template>

<!-- ******************************************************** -->

<template name="displayAvailableBooks">
	<h5>L'ensemble des livres disponibles dans la communauté</h5>

	<div class="panel-body">
      	<div class="row">
      	 {{#each availableBooks}}
    			<a class="img-thumbnail img-responsive">
     			<!-- Référence au template bookimage pour afficher l'image du livre dans une div -->
           {{> bookimage}}         
    			</a>
  			{{/each}}
  		</div>	
  	</div>
</template>

<!-- ******************************************************** -->

<template name="displaySearchedBooks">
	<h5>Livres disponibles à l'emprunt correspondants à votre recherche</h5>
	 <div class="panel-body">
      	<div class="row">

	      	{{#if tryToSearch}}
		      	{{#if searchInAllAvailableBooks.count}}
		      	 {{#each searchInAllAvailableBooks}}
		    			<a class="img-thumbnail img-responsive proposedBook">
		     			<!-- Référence au template bookimage pour afficher l'image du livre dans une div -->
		           {{> bookimage}}         
		    			</a>
		  			{{/each}}
		  		{{else}}
		         <!-- Phrase si pas de livre dans cette partie de la biblio...-->
		         Désolé! Aucun livre de notre base de donnéee ne correspond à votre recherche!
		        {{/if}}
		    {{else}}
		    <!-- Phrase avant de faire une recherche...-->
		         Vas y cherche !
		    {{/if}}
  		</div>	
  	</div>
</template>

<!-- ******************************************************** -->

<!-- TEMPLATE pour afficher le livre actuellement sélectionné dans la proposition suite à la recherche  -->
<template name="displayChosenBook">
	{{#if myChosenBook}}
		{{#if currentUser}}
			<!-- on valide que le livre est bien disponible  -->
			{{#if usersWhoShareIt.count}}
					<div class="thumbnail">
				      <img class="thumb-books" src="{{myChosenBook.thumb}}" width="100" height="140">
				      <div class="caption">
				        <h3>{{myChosenBook.title}} by {{myChosenBook.authors}}</h3>
				        <p>{{myChosenBook.snippet}}</p>
				        <p class="text-center"></p>
				     	<h5>This book is available close to you :</h5>
				     	<div class="table-responsive">
  							<table class="table table-condensed">
  								
				     	{{#each usersWhoShareIt}} 
				    		<tr><td>{{userInfos.firstName}}...</td>
				    		<td>à {{userInfos.distance}} {{userInfos.unit}} from you</td></tr>
						{{/each}}
					</table>
					</div>
				      </div>
				    </div>
			<!-- si le livre n'est pas disponible, on fait en sorte de l'ajouter à la wishliste -->
			{{else}}
				<div class="thumbnail">
				    <img class="thumb-books" src="{{myChosenBook.thumb}}" width="100" height="140">
				    <div class="caption">
				        <h3>{{myChosenBook.title}} by {{myChosenBook.authors}}</h3>
				        <p>{{myChosenBook.snippet}}</p>
				     	<h5>Ce livre est victime de son succès, tous les exemplaires sont présentement prêtés. Ajoute-le à ta wishlist et nous te préviendrons dès qu'un exemplaire sera disponible près de chez toi.</h5>
				    </div>
				    <p class="text-center">
				    <!-- même bouton étoile que dans le Lend -->
        			<a href="#" class="btn btn-success" role="button"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>Ajouter à ma Wishlist</a></p>
				</div>
			{{/if}}
	    {{else}}
	    	<!-- on valide que le livre est bien disponible  -->
	    	{{#if usersWhoShareIt.count}}
		    	<div class="thumbnail">
			      <img class="thumb-books" src="{{myChosenBook.thumb}}" width="100" height="140">
			      <div class="caption">
			        <h3>{{myChosenBook.title}} by {{myChosenBook.authors}}</h3>
			        <p>{{myChosenBook.snippet}}</p>
			        <p class="text-center"></p>
			     	<h5>Ce livre est disponible et {{usersWhoShareIt.count}} utilisateurs peuvent te le prêter</h5>
			     	<h5>Connecte-toi vite pour les contacter!</h5>
			     	<!-- Les bouton s'enregistrer et se connecter ne sont pas actifs pour l'instant -->
	        		<p><a class="se connecter" role="button"> Se connecter</a> </p> <p><a class="s'inscrire" role="button"> S'inscrire</a> </p>          		
			     </div>
			    </div>

			<!-- si le livre n'est pas disponible, on dit qu'il le sera bientôt et on fait en sorte que l'utilisateur s'enregistre pour commencer une wishliste  -->
			{{else}}
				<h3>caca pour user non connecté</h3>
			{{/if}}
    	{{/if}}
    {{/if}}
</template>

<!-- ******************************************************** -->

<!-- TEMPLATE pour afficher la carte de la disponibilité d'un bouquin autour de chez moi  -->

<template name="booksMap">

	 <div class="map-container">
       {{> googleMap name="booksMap" options=booksMapOptions coordinates=usersCoordinates}}

   </div>
</template>


